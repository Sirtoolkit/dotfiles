#!{{ lookPath "sh" }}

# Removemos set -e para que no falle si alguna herramienta no se instala correctamente
{{ if eq .chezmoi.os "darwin" -}}

if ! command -v mise >/dev/null 2>&1; then
  echo "âœ… 'mise' no estÃ¡ instalado. Saltando la instalaciÃ³n de herramientas."
  exit 0
fi

CONFIG_FILE="${HOME}/.config/mise/config.toml"

if [ -f "$CONFIG_FILE" ]; then
    echo "ğŸš€ Instalando herramientas globales de 'mise' desde $CONFIG_FILE..."

    # Intentar instalar las herramientas, pero no fallar si alguna falla
    if mise install; then
        echo "ğŸ› ï¸ Refrescando los shims de 'mise'..."
        mise reshim
        echo "âœ… Â¡Herramientas de 'mise' instaladas correctamente!"
    else
        echo "âš ï¸  Algunas herramientas de 'mise' fallaron al instalarse, pero continuando..."
        echo "ğŸ› ï¸ Refrescando los shims de 'mise' para las que sÃ­ se instalaron..."
        mise reshim
        echo "âœ… Proceso completado con algunos errores."
    fi
else
    echo "â„¹ï¸  No se encontrÃ³ el archivo de configuraciÃ³n global de 'mise'. Saltando instalaciÃ³n."
fi
{{ end -}}