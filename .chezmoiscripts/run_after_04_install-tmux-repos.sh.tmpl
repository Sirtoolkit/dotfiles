#!{{ lookPath "sh" }}

{{ if eq .chezmoi.os "darwin" -}}
set -e

# Colores para output
if [ -t 1 ] && [ -n "$TERM" ] && [ "$TERM" != "dumb" ]; then
    BLUE='\033[0;34m'
    GREEN='\033[0;32m'
    YELLOW='\033[1;33m'
    NC='\033[0m'
else
    BLUE=''
    GREEN=''
    YELLOW=''
    NC=''
fi

PLUGINS_DIR="$HOME/.config/tmux/plugins"
TPM_DIR="$PLUGINS_DIR/tpm"
TPM_REPO="https://github.com/tmux-plugins/tpm.git"
GRUVBOX_DIR="$PLUGINS_DIR/tmux-gruvbox"
GRUVBOX_REPO="https://github.com/egel/tmux-gruvbox.git"
WINDOW_NAME_DIR="$PLUGINS_DIR/tmux-window-name"
WINDOW_NAME_REPO="https://github.com/ofirgall/tmux-window-name.git"
PAIN_CONTROL_DIR="$PLUGINS_DIR/tmux-pain-control"
PAIN_CONTROL_REPO="https://github.com/tmux-plugins/tmux-pain-control.git"

mkdir -p "$PLUGINS_DIR"

# Instalar TPM
if [ -d "$TPM_DIR" ]; then
  printf "%b\n" "${GREEN}✓ TPM ya está instalado${NC}"
else
  printf "%b\n" "${BLUE}Clonando TPM...${NC}"
  git clone "$TPM_REPO" "$TPM_DIR"
  printf "%b\n" "${GREEN}✓ TPM instalado${NC}"
fi

# Instalar plugins de tmux
printf "%b\n" "${BLUE}Instalando plugins de tmux...${NC}"
if "$TPM_DIR/bin/install_plugins"; then
    printf "%b\n" "${GREEN}✓ Plugins instalados${NC}"
else
    printf "%b\n" "${YELLOW}⚠ Algunos plugins pueden no haberse instalado${NC}"
fi

# Instalar tema Gruvbox
if [ -d "$GRUVBOX_DIR" ]; then
  printf "%b\n" "${GREEN}✓ tmux-gruvbox ya está instalado${NC}"
else
  printf "%b\n" "${BLUE}Clonando tmux-gruvbox...${NC}"
  git clone "$GRUVBOX_REPO" "$GRUVBOX_DIR"
  printf "%b\n" "${GREEN}✓ Tema instalado${NC}"
fi

# Instalar tmux-window-name
if [ -d "$WINDOW_NAME_DIR" ]; then
  printf "%b\n" "${GREEN}✓ tmux-window-name ya está instalado${NC}"
else
  printf "%b\n" "${BLUE}Instalando libtmux...${NC}"
  python3 -m pip install --user libtmux
  printf "%b\n" "${BLUE}Clonando tmux-window-name...${NC}"
  git clone "$WINDOW_NAME_REPO" "$WINDOW_NAME_DIR"
  printf "%b\n" "${GREEN}✓ tmux-window-name instalado${NC}"
fi

# Instalar tmux-pain-control
if [ -d "$PAIN_CONTROL_DIR" ]; then
  printf "%b\n" "${GREEN}✓ tmux-pain-control ya está instalado${NC}"
else
  printf "%b\n" "${BLUE}Clonando tmux-pain-control...${NC}"
  git clone "$PAIN_CONTROL_REPO" "$PAIN_CONTROL_DIR"
  printf "%b\n" "${GREEN}✓ tmux-pain-control instalado${NC}"
fi

printf "%b\n" "${GREEN}✓ Plugins de tmux configurados${NC}"
{{ end -}}
