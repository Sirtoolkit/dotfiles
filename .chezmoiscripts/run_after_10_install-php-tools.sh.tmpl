#!{{ lookPath "sh" }}

{{ if eq .chezmoi.os "darwin" -}}
set -e

# AÃ±adir Homebrew al PATH
export PATH=/opt/homebrew/bin:$PATH

# AÃ±adir Composer global bin al PATH
export PATH=$HOME/.config/composer/vendor/bin:$PATH

# TÃ­tulo del script para logs
echo "ğŸš€ Iniciando instalaciÃ³n de herramientas globales de PHP..."

# 1. Verificar si Composer estÃ¡ instalado
if ! command -v composer >/dev/null 2>&1; then
    echo "âŒ Error: Composer no se encuentra en el PATH."
    echo "   Por favor, instala PHP y Composer antes de ejecutar este script."
    exit 1
fi

# Lista de paquetes globales a instalar
PACKAGES=(
    "laravel/installer"
    "laravel/valet"
)

for PACKAGE in "${PACKAGES[@]}"; do
    if composer global show "$PACKAGE" >/dev/null 2>&1; then
        echo "âœ… $PACKAGE ya estÃ¡ instalado globalmente."
    else
        echo "ğŸ“¦ Instalando $PACKAGE globalmente..."
        composer global require "$PACKAGE"
        
        if [ $? -eq 0 ]; then
            echo "âœ… $PACKAGE instalado correctamente."
        else
            echo "âŒ Hubo un error instalando $PACKAGE."
            exit 1
        fi
    fi
done

# ConfiguraciÃ³n especÃ­fica para Valet
if command -v valet >/dev/null 2>&1; then
    echo "ğŸ”§ Ejecutando valet install..."
    valet install
    echo "âœ… Valet configurado."
else
    echo "âš ï¸ Valet no se encontrÃ³ en el PATH, asegÃºrate de que ~/.config/composer/vendor/bin estÃ© en tu PATH."
fi

echo "ğŸ‰ ConfiguraciÃ³n de herramientas PHP completada."
{{ end }}
